Role Name
=========

This role aims to provdie a tool for upgrading openvswitch from 2.6(newton) to 2.8(queens).

Requirements
============

This role requires:

* An ansible inventory file containing reacheable overcloud nodes (e.g hosts)
* A shell script (generate_inventory.sh) is provided in inventory/ to generate overcloud hosts file.


Role Variables
==============

Tripleo repos URL:

    tripleo_repos_url

Openvswitch config directory:

    ovs_config_dir

Openvswitch log directory:

    ovs_log_dir

Openvswitch run directory:

    ovs_run_dir

Os-net-config config.json file path, this file is auto-generated by os-net-config during overcloud deployment:

    net_config_file

Whether DPDK is enabled on the upgrading node, set this to true against dpdk-enabled compute nodes, and false against controller and non-dpdk compute nodes (user will need to modify inventory file 'hosts' to separate dpdk nodes and non-dpdk nodes in order to apply this parameter to different nodes):

    dpdk_enabled

DPDK port mapping ( dpdk_port_name: pci_address), this parameter is not defined by default:

    dpdk_ports

Dpdk_mapping_file which saves dpdk port informations, this file is auto-generated by os-net-config when dpdk is configured in that node:

    dpdk_mapping_file

Dependencies
============

None

Example Playbook
================

An example playbook is provided in playbooks/ovs_upgrade.yml:

    ---
    - hosts: controller
      gather_facts: true
      roles:
        - ovs_upgrade

    - hosts: compute
      gather_facts: true
      roles:
        - { role: ovs_upgrade, dpdk_enabled: "true" }

Usage
=====

Clone ovs_upgrade role to undercloud dir /home/stack/ :

    git clone https://github.com/zshi-redhat/ovs_upgrade.git
  
Generate overcloud inventory file 'hosts':

    bash ovs_upgrade/inventory/generate_inventory.sh
  
Execute ansible playbook:

    ansible-playbook -i hosts ovs_upgrade/playbooks/ovs_upgrade.yml
